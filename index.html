<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pharos Spin Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.4/dist/ethers.min.js"></script>
  <style>
    body { background: #0f172a; color: white; }
    .wheel {
      width: 300px; height: 300px;
      border-radius: 50%; border: 10px solid #22d3ee;
      display: flex; align-items: center; justify-content: center;
      font-size: 24px; font-weight: bold;
      transition: transform 4s cubic-bezier(0.25, 1, 0.5, 1);
      background: conic-gradient(#22d3ee 0 45deg, #fbbf24 45deg 90deg,
                                 #34d399 90deg 135deg, #f87171 135deg 180deg,
                                 #818cf8 180deg 225deg, #facc15 225deg 270deg,
                                 #ec4899 270deg 315deg, #10b981 315deg 360deg);
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen space-y-6">

  <h1 class="text-3xl font-bold">ðŸŽ° Pharos Spin Game</h1>
  <button id="connectBtn" class="px-6 py-3 bg-emerald-500 rounded-lg font-semibold">Connect Wallet</button>

  <div class="relative">
    <div id="wheel" class="wheel">SPIN</div>
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-20 text-2xl">â¬†</div>
  </div>

  <button id="spinBtn" disabled class="px-6 py-3 bg-sky-500 rounded-lg font-semibold">Spin (0.1 PHRS)</button>
  <p id="result" class="text-xl font-bold"></p>

  <script>
    const PHAROS_RPC = "https://rpc.testnet.pharos.network"; // RPC
    const TOKEN_ADDRESS = "0xAf7932A1f9A25897d9F4d5A63d74d0db3094E3b5"; // From docs (PHRS token)
    const TOKEN_ABI = [
      "function transfer(address to, uint amount) public returns (bool)",
      "function decimals() view returns (uint8)"
    ];

    let provider, signer, token;

    async function connectWallet() {
      if (!window.ethereum) { alert("Please install MetaMask!"); return; }
      try {
        await ethereum.request({ method: "eth_requestAccounts" });
        provider = new ethers.BrowserProvider(window.ethereum);
        signer = await provider.getSigner();
        token = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
        document.getElementById("spinBtn").disabled = false;
        alert("Wallet connected. Ready to spin!");
      } catch (err) {
        console.error(err); alert("Connection failed!");
      }
    }

    async function spinGame() {
      try {
        // send 0.1 PHRS
        const decimals = await token.decimals();
        const amount = ethers.parseUnits("0.1", decimals);
        const tx = await token.transfer("0xF787b0A9B186c24d19b8c1681aF09DbEEb2160E9", amount);
        await tx.wait();

        // spin animation
        const wheel = document.getElementById("wheel");
        const resultText = document.getElementById("result");
        const rewards = [10,20,30,100,500,1000,3000];
        const reward = rewards[Math.floor(Math.random()*rewards.length)];
        const deg = 1440 + Math.floor(Math.random()*360); // 4 spins + random
        wheel.style.transform = `rotate(${deg}deg)`;

        setTimeout(()=>{
          resultText.textContent = `ðŸŽ‰ You won ${reward} points! (Txn Hash: ${tx.hash.slice(0,10)}...)`;
        }, 4000);

      } catch (err) {
        console.error(err);
        alert("Spin failed! " + err.message);
      }
    }

    document.getElementById("connectBtn").onclick = connectWallet;
    document.getElementById("spinBtn").onclick = spinGame;
  </script>
</body>
</html>
